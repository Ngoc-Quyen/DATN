<% extend("master.ejs") %>
  <!-- Page Heading -->
  <div class="d-sm-flex flex-column align-items-start justify-content-between mb-4">
    <h1 class="h3 mb-0 text-gray-800 mb-4 ">Giải quyết lịch xin nghỉ phép </h1>
    <div class="card shadow mb-4 ">
      <div class="card-header py-3">
        <h4 class="m-0 font-weight-bold text-primary">Thông tin lịch xin nghỉ phép </h4>
      </div>
      <div class="card-body d-flex">
        <div class="doctorName mb-3 mr-3">
          <label for="doctorNamw">Họ tên</label>
          <input type="text" class="form-control" id="doctorName" name="doctorName" value="<%= timeOff.doctorName %>"
            data-doctor-id="<%= timeOff.doctorId %>" readonly>
        </div>
        <div class="specializationName mb-3 mr-3">
          <label for="specializationName">Chuyên khoa</label>
          <input type="text" class="form-control" id="specializationName" name="specializationName"
            value="<%= timeOff.specializationName %>" readonly>
        </div>
        <div class="startDate mb-3 mr-3">
          <label for="timeOffDate">Thời gian nghỉ</label>
          <input type="text" class="form-control" id="timeOffDate" name="timeOffDate"
            value="<%= new Date(timeOff.startDate).toLocaleDateString('vi-VN') %> - <%= new Date(timeOff.endDate).toLocaleDateString('vi-VN') %>"
            readonly>
        </div>
        <div class="reason mb-3 mr-3">
          <label for="reason">Lí do</label>
          <input type="text" class="form-control" id="reason" name="reason" value="<%= timeOff.reason %>"
            title="<%= timeOff.reason %>" readonly>
        </div>
        <div class="status mb-3 mr-3">
          <label for="status">Trạng thái</label>
          <input type="text" class="form-control" id="status" name="status" value="<% if (timeOff.statusId===1) { %> Đã duyệt
            <% } else if (timeOff.statusId===3) { %> Chờ duyệt
            <% } else { %> Không duyệt
            <% } %>" readonly>
        </div>
        <div class="button d-flex align-items-center justify-content-evenly">
          <button class="btn btn-primary mr-2 <%=timeOff.statusId ===3 ? 'cursor-pointer' : 'disable' %>"
            style="margin-bottom: -17px;" id="btnAcceptTimeOff" data-time-off-id="<%= timeOff.id  %>"
            <%=timeOff.statusId !==3 ? 'disabled' : '' %>>Đồng
            ý</button>
          <button class="btn btn-danger bg-danger <%=timeOff.statusId ===3 ? 'cursor-pointer' : 'disable' %>"
            style="margin-bottom: -17px;" id="btnRefuseTimeOff" data-time-off-id="<%= timeOff.id  %>"
            <%=timeOff.statusId !==3 ? 'disabled' : '' %>>Từ
            chối</button>
        </div>
      </div>
    </div>
  </div>

  <div class="card shadow mb-4">
    <div class="card-header py-3">
      <h6 class="m-0 font-weight-bold text-primary">Danh sách bác sĩ phù hợp</h6>
    </div>
    <div class="card-body">
      <% if (listReschedule.length===0) { %>
        <p class="text-center text-muted">
          <%= message %>
        </p>
        <% } else { %>
          <div class="table-responsive">
            <table class="table table-bordered" id="dataTable" width="100%" cellspacing="0">
              <thead>
                <tr>
                  <th>Tên bác sĩ phù hợp</th>
                  <th>Ngày đổi</th>
                  <th>Loại ca làm việc</th>
                  <th>Thời gian thay thế</th>
                  <th>Trạng thái</th>
                  <th>Hành động</th>
                </tr>
              </thead>
              <tbody>
                <% listReschedule.forEach(function(reSchedule) { %>
                  <tr>
                    <td>
                      <%= reSchedule.doctorSwapName %>
                    </td>
                    <td>
                      <%= new Date(reSchedule.dateASwap).toLocaleDateString('vi-VN') %>
                    </td>
                    <td>
                      <%= reSchedule.type==='regular' ? 'Ca thường' : 'Ca trực' %>
                    </td>
                    <td>
                      <%= new Date(reSchedule.dateBSwap).toLocaleDateString('vi-VN') %>
                    </td>
                    <td>
                      <%= reSchedule.statusId===1 ? 'Đã duyệt' : reSchedule.statusId===2 ? 'Không duyệt' :
                        reSchedule.statusId===3 ?'Chờ duyệt' : 'Gợi ý' %>
                    </td>
                    <td>
                      <button
                        class="btn btn-primary <%= reSchedule.statusId === 4 ? 'cursor-pointer' : 'disabled' %>  w-50"
                        <%=reSchedule.statusId !==4 ? 'disabled' : '' %>
                        title="Lưu" id="btnSaveOptionSwapSchedule"
                        data-doctor-id="<%= timeOff.doctorId %>"
                          data-doctor-swap-id="<%= reSchedule.doctorSwapId %>"
                            data-date-a-swap="<%= reSchedule.dateASwap %>"
                              data-date-b-swap="<%= reSchedule.dateBSwap %>"
                                data-type="<%= reSchedule.type %>"
                                  data-status-id="<%= reSchedule.statusId %>">
                                    <i class="fas fa-save fs-5"></i>
                      </button>
                    </td>
                  </tr>
                  <% }) %>
              </tbody>
            </table>
          </div>
          <% } %>
    </div>
  </div>


  <script>
    $(document).ready(function () {
      $("div #featureManage").addClass('show');
      $("div #featureManage").find($("#aManageReschedule")).addClass("active");
      $(".admin-list-posts").removeClass("active");
    })
  </script>
